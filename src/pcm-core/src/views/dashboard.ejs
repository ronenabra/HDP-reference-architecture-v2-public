<!DOCTYPE html>
<html>

<head>
    <title>PCM Patient Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<h1>My Consents</h1>
<div class="alert alert-info d-flex justify-content-between">
    <span>Simulated Patient Portal</span>
    <div class="dropdown">
        <a href="/docs/api" class="btn btn-sm btn-outline-primary me-2" target="_blank">API Docs</a>
        <a href="http://localhost:4000/logs-view" class="btn btn-sm btn-outline-dark" target="_blank">Central System
            Logs</a>
    </div>
</div>

<h3>Pending Requests</h3>
<div class="card">
    <div class="card-header bg-light">
        <strong>Consent Registry</strong>
    </div>
    <div class="card-body p-0">
        <% if (consents.length===0) { %>
            <div class="p-3 text-center text-muted">No consent requests found.</div>
            <% } else { %>
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Status</th>
                            <th>Consent ID</th>
                            <th>Parent Organization</th>
                            <th>Service Provider</th>
                            <th>Purpose / Service</th>
                            <th>Patient</th>
                            <th>Review</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% consents.forEach(function(c) { %>
                            <tr>
                                <td>
                                    <span
                                        class="badge bg-<%= c.status === 'proposed' ? 'warning text-dark' : (c.status === 'active' ? 'success' : 'secondary') %>">
                                        <%= c.status %>
                                    </span>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        <%= c.id %>
                                    </small>
                                </td>
                                <td>
                                    <%= c.parentOrgName %>
                                </td>
                                <td>
                                    <!-- Requester Name (Org) -->
                                    <%= c.requesterName %>
                                </td>
                                <td>
                                    <%= c.serviceName %>
                                </td>
                                <td>
                                    <%= c.patient?.identifier?.value || 'N/A' %>
                                </td>
                                <td>
                                    <% if (c.status==='proposed' ) { %>
                                        <a href="/ui/approve/<%= c.id %>" class="btn btn-sm btn-primary">Review</a>
                                        <% } else { %>
                                            <button class="btn btn-sm btn-secondary" disabled>Approved</button>
                                            <% } %>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>
                <% } %>
    </div>
</div>
</body>

</html>